<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>C·∫ßn Th∆° MotoTrip: N2 Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700;900&display=swap"
      rel="stylesheet" />
    <style>
      /* <!-- Chosen Palette: Adventure Green & Asphalt (Emerald, Slate, Amber) --> */
      /* <!-- Application Structure: Added Route Selector (QL1A vs N2) to dynamically change content. --> */

      body {
        font-family: 'Be Vietnam Pro', sans-serif;
        background-color: #f0fdf4; /* Light Green Tint for Nature vibe */
        color: #0f172a;
      }

      .chart-container {
        position: relative;
        width: 100%;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
        height: 300px;
        max-height: 400px;
      }

      .glass-panel {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(8px);
        border: 1px solid #e2e8f0;
      }

      .food-card-img {
        transition: transform 0.5s ease;
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      .food-card:hover .food-card-img {
        transform: scale(1.05);
      }

      .img-skeleton {
        background-color: #cbd5e1;
        animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }
      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      /* Checkbox custom style */
      .biker-check:checked + label {
        text-decoration: line-through;
        color: #94a3b8;
      }

      /* Route Switcher Toggle */
      .route-toggle {
        display: flex;
        background: #e2e8f0;
        border-radius: 999px;
        padding: 4px;
        position: relative;
        cursor: pointer;
        width: 240px;
        margin: 0 auto;
      }
      .route-toggle div {
        flex: 1;
        text-align: center;
        padding: 8px 16px;
        z-index: 10;
        font-weight: bold;
        transition: color 0.3s;
      }
      .route-bg {
        position: absolute;
        top: 4px;
        left: 4px;
        height: calc(100% - 8px);
        width: calc(50% - 4px);
        background: #fff;
        border-radius: 999px;
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      /* States */
      .route-mode-ql1a .route-bg {
        transform: translateX(0);
        background: #64748b;
      }
      .route-mode-ql1a .opt-ql1a {
        color: white;
      }
      .route-mode-n2 .route-bg {
        transform: translateX(100%);
        background: #10b981;
      }
      .route-mode-n2 .opt-n2 {
        color: white;
      }

      /* Chatwidget Styles */
      .chat-widget {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1000;
        display: flex;
        flex-direction: column;
        align-items: flex-end;
      }

      .chat-button {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: linear-gradient(135deg, #10b981 0%, #059669 100%); /* Green for N2 vibe */
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        cursor: pointer;
        transition: transform 0.3s ease;
        font-size: 30px;
      }

      .chat-button:hover {
        transform: scale(1.1);
      }

      .chat-window {
        width: 350px;
        height: 500px;
        background: white;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        margin-bottom: 20px;
        display: none;
        flex-direction: column;
        overflow: hidden;
        border: 1px solid #e2e8f0;
      }

      .chat-header {
        background: #064e3b;
        color: white;
        padding: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .chat-messages {
        flex-grow: 1;
        padding: 15px;
        overflow-y: auto;
        background: #f0fdf4;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .message {
        max-width: 80%;
        padding: 10px 15px;
        border-radius: 15px;
        font-size: 14px;
        line-height: 1.4;
      }

      .message.user {
        background: #10b981;
        color: white;
        align-self: flex-end;
        border-bottom-right-radius: 2px;
      }

      .message.ai {
        background: white;
        color: #1e293b;
        align-self: flex-start;
        border-bottom-left-radius: 2px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      }

      .chat-input-area {
        padding: 15px;
        background: white;
        border-top: 1px solid #e2e8f0;
        display: flex;
        gap: 10px;
      }

      .chat-input-area input {
        flex-grow: 1;
        padding: 10px;
        border: 1px solid #cbd5e1;
        border-radius: 20px;
        outline: none;
      }

      .chat-input-area input:focus {
        border-color: #10b981;
      }

      .typing-indicator span {
        display: inline-block;
        width: 6px;
        height: 6px;
        background-color: #94a3b8;
        border-radius: 50%;
        animation: typing 1s infinite ease-in-out;
        margin-right: 3px;
      }

      .typing-indicator span:nth-child(1) {
        animation-delay: 0s;
      }
      .typing-indicator span:nth-child(2) {
        animation-delay: 0.2s;
      }
      .typing-indicator span:nth-child(3) {
        animation-delay: 0.4s;
      }

      @keyframes typing {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-5px);
        }
      }

      /* Modal for Food Review */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 2000;
        display: none;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(4px);
      }
      .modal-content {
        background: white;
        width: 90%;
        max-width: 500px;
        border-radius: 20px;
        padding: 25px;
        position: relative;
        max-height: 80vh;
        overflow-y: auto;
      }

      /* Button Icon Styles */
      .btn-icon {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        transition: all 0.2s;
      }
      .btn-icon:hover {
        transform: translateY(-1px);
      }
    </style>
  </head>
  <body class="antialiased min-h-screen flex flex-col route-mode-n2">
    <!-- Navigation -->
    <nav class="sticky top-0 z-50 bg-white/95 backdrop-blur shadow-sm border-b border-gray-200">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16 items-center">
          <div class="flex items-center gap-2">
            <span class="text-2xl">üèçÔ∏è</span>
            <div class="text-xl font-bold text-slate-800 tracking-tight">
              Moto<span class="text-emerald-600">N2</span>
            </div>
          </div>
          <div class="hidden md:flex space-x-8">
            <button
              onclick="scrollToSection('overview')"
              class="text-slate-600 hover:text-emerald-600 font-bold transition">
              L·ªô Tr√¨nh
            </button>
            <button
              onclick="scrollToSection('checklist')"
              class="text-slate-600 hover:text-emerald-600 font-bold transition">
              Ki·ªÉm Tra Xe
            </button>
            <button
              onclick="scrollToSection('itinerary')"
              class="text-slate-600 hover:text-emerald-600 font-bold transition">
              L·ªãch Tr√¨nh
            </button>
            <button
              onclick="scrollToSection('food')"
              class="text-slate-600 hover:text-emerald-600 font-bold transition">
              ƒÇn Ch∆°i
            </button>
          </div>
          <button class="md:hidden text-2xl" onclick="toggleMobileNav()">‚ò∞</button>
        </div>
      </div>
      <div id="mobile-nav" class="hidden md:hidden bg-white border-b border-gray-200 p-4 space-y-3">
        <button
          onclick="scrollToSection('overview')"
          class="block w-full text-left text-slate-700 font-bold">
          L·ªô Tr√¨nh
        </button>
        <button
          onclick="scrollToSection('checklist')"
          class="block w-full text-left text-slate-700 font-bold">
          Ki·ªÉm Tra Xe
        </button>
        <button
          onclick="scrollToSection('itinerary')"
          class="block w-full text-left text-slate-700 font-bold">
          L·ªãch Tr√¨nh
        </button>
        <button
          onclick="scrollToSection('food')"
          class="block w-full text-left text-slate-700 font-bold">
          ƒÇn Ch∆°i
        </button>
      </div>
    </nav>

    <!-- Hero Section -->
    <section id="overview" class="pt-10 pb-8 px-4 sm:px-6 lg:px-8 max-w-6xl mx-auto w-full">
      <div class="text-center mb-10">
        <span
          class="inline-block py-1 px-3 rounded bg-emerald-100 text-emerald-800 text-xs font-black uppercase tracking-wider mb-3"
          >Ph∆∞·ª£t Xe M√°y 2026</span
        >
        <h1 class="text-4xl sm:text-6xl font-black text-slate-900 mb-6 tracking-tighter">
          S√ÄI G√íN <span class="text-slate-300 mx-2">‚ûî</span>
          <span class="text-transparent bg-clip-text bg-gradient-to-r from-emerald-600 to-teal-500"
            >C·∫¶N TH∆†</span
          >
        </h1>

        <!-- Route Switcher -->
        <div class="mb-8">
          <p class="text-sm text-slate-500 mb-3 font-bold uppercase tracking-wide">
            Ch·ªçn Cung ƒê∆∞·ªùng C·ªßa B·∫°n:
          </p>
          <div class="route-toggle" onclick="toggleRoute()">
            <div class="route-bg"></div>
            <div class="opt-ql1a">QL1A (Truy·ªÅn Th·ªëng)</div>
            <div class="opt-n2">ƒê∆∞·ªùng N2 (C·∫£nh ƒê·∫πp)</div>
          </div>
        </div>

        <p
          id="route-desc"
          class="text-lg text-slate-700 max-w-2xl mx-auto font-medium leading-relaxed">
          ƒêang ch·ªçn: <strong>Cung ƒë∆∞·ªùng N2</strong>. <br />
          Xuy√™n r·ª´ng tr√†m, ru·ªông l√∫a ƒê·ªìng Th√°p M∆∞·ªùi. √çt c√¥ng an, √≠t b·ª•i, c·∫£nh si√™u chill nh∆∞ng v·∫Øng
          v·∫ª.
        </p>
      </div>

      <!-- Quick Stats Cards (Dynamic) -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
        <div
          class="glass-panel p-6 rounded-xl border-l-4 border-emerald-500 shadow-sm transition-all hover:shadow-md">
          <div class="text-3xl mb-2" id="stat-icon-1">üå≤</div>
          <h3 class="font-bold text-slate-800 text-lg" id="stat-title-1">C·∫£nh Quan</h3>
          <p class="text-slate-600 text-sm mt-1" id="stat-desc-1">
            Ru·ªông l√∫a, Sen, R·ª´ng tr√†m. R·∫•t m√°t m·∫Øt v√† tho√°ng ƒë√£ng.
          </p>
        </div>
        <div
          class="glass-panel p-6 rounded-xl border-l-4 border-amber-500 shadow-sm transition-all hover:shadow-md">
          <div class="text-3xl mb-2" id="stat-icon-2">‚ö†Ô∏è</div>
          <h3 class="font-bold text-slate-800 text-lg" id="stat-title-2">L∆∞u √ù N2</h3>
          <p class="text-slate-600 text-sm mt-1" id="stat-desc-2">
            √çt c√¢y xƒÉng & ch·ªó s·ª≠a xe. Tuy·ªát ƒë·ªëi kh√¥ng ƒëi ƒë√™m v√¨ thi·∫øu ƒë√®n ƒë∆∞·ªùng.
          </p>
        </div>
        <div
          class="glass-panel p-6 rounded-xl border-l-4 border-blue-500 shadow-sm transition-all hover:shadow-md">
          <div class="text-3xl mb-2" id="stat-icon-3">üìç</div>
          <h3 class="font-bold text-slate-800 text-lg" id="stat-title-3">L·ªô Tr√¨nh</h3>
          <p class="text-slate-600 text-sm mt-1" id="stat-desc-3">
            An S∆∞∆°ng ‚ûî ƒê·ª©c H√≤a ‚ûî Th·∫°nh H√≥a ‚ûî M·ªπ An ‚ûî Cao L√£nh ‚ûî C·∫ßu V√†m C·ªëng.
          </p>
        </div>
      </div>
    </section>

    <!-- Biker Checklist -->
    <section id="checklist" class="py-8 bg-slate-900 text-white w-full">
      <div class="max-w-4xl mx-auto px-4 sm:px-6">
        <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
          <span>üîß</span> B·∫£o D∆∞·ª°ng (ƒê·∫∑c bi·ªát quan tr·ªçng cho N2)
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div
            class="flex items-center gap-3 p-3 bg-slate-800 rounded border border-slate-700 hover:border-emerald-500 transition cursor-pointer"
            onclick="document.getElementById('check1').click()">
            <input type="checkbox" id="check1" class="biker-check w-5 h-5 accent-emerald-500" />
            <label for="check1" class="cursor-pointer select-none"
              >ƒê·ªï ƒë·∫ßy b√¨nh xƒÉng (C·ª© th·∫•y c√¢y l·ªõn l√† ƒë·ªï)</label
            >
          </div>
          <div
            class="flex items-center gap-3 p-3 bg-slate-800 rounded border border-slate-700 hover:border-emerald-500 transition cursor-pointer"
            onclick="document.getElementById('check2').click()">
            <input type="checkbox" id="check2" class="biker-check w-5 h-5 accent-emerald-500" />
            <label for="check2" class="cursor-pointer select-none"
              >Mang theo ru·ªôt xe d·ª± ph√≤ng (N2 r·∫•t v·∫Øng)</label
            >
          </div>
          <div
            class="flex items-center gap-3 p-3 bg-slate-800 rounded border border-slate-700 hover:border-emerald-500 transition cursor-pointer"
            onclick="document.getElementById('check3').click()">
            <input type="checkbox" id="check3" class="biker-check w-5 h-5 accent-emerald-500" />
            <label for="check3" class="cursor-pointer select-none"
              >Ki·ªÉm tra l·ªëp xe & th·∫Øng (Phanh)</label
            >
          </div>
          <div
            class="flex items-center gap-3 p-3 bg-slate-800 rounded border border-slate-700 hover:border-emerald-500 transition cursor-pointer"
            onclick="document.getElementById('check4').click()">
            <input type="checkbox" id="check4" class="biker-check w-5 h-5 accent-emerald-500" />
            <label for="check4" class="cursor-pointer select-none"
              >√Åo kho√°c, k√≠nh r√¢m (N·∫Øng nh∆∞ng gi√≥ m·∫°nh)</label
            >
          </div>
        </div>
      </div>
    </section>

    <!-- Itinerary Section -->
    <section id="itinerary" class="py-12 bg-white w-full">
      <div class="max-w-5xl mx-auto px-4 sm:px-6">
        <div class="mb-10 text-center">
          <h2 class="text-3xl font-black text-slate-900 uppercase">L·ªãch Tr√¨nh Di Chuy·ªÉn</h2>
          <p class="text-slate-500 mt-1" id="itinerary-subtitle">
            ƒêang hi·ªÉn th·ªã l·ªô tr√¨nh N2 (ƒê·ªìng Th√°p M∆∞·ªùi)
          </p>
        </div>

        <!-- Tabs -->
        <div class="flex justify-center mb-8 space-x-2 sm:space-x-4">
          <button
            onclick="switchDay(1)"
            id="tab-day1"
            class="px-5 py-2 rounded font-bold transition bg-emerald-600 text-white shadow-md transform scale-105 border-2 border-emerald-600">
            Ng√†y 1 (31/1)
          </button>
          <button
            onclick="switchDay(2)"
            id="tab-day2"
            class="px-5 py-2 rounded font-bold transition bg-slate-100 text-slate-600 hover:bg-slate-200 border-2 border-transparent">
            Ng√†y 2 (1/2)
          </button>
          <button
            onclick="switchDay(3)"
            id="tab-day3"
            class="px-5 py-2 rounded font-bold transition bg-slate-100 text-slate-600 hover:bg-slate-200 border-2 border-transparent">
            Ng√†y 3 (2/2)
          </button>
        </div>

        <div
          class="relative border-l-4 border-slate-200 ml-4 md:ml-6 pl-8 space-y-8"
          id="timeline-content">
          <!-- Content injected via JS -->
        </div>
      </div>
    </section>

    <!-- Food Section -->
    <section id="food" class="py-12 bg-slate-50 w-full">
      <div class="max-w-6xl mx-auto px-4 sm:px-6">
        <div class="text-center mb-10">
          <h2 class="text-3xl font-black text-slate-900 uppercase">Tr·∫°m Ti·∫øp Th·ª±c</h2>
          <p class="text-slate-600 mt-2">D·ªØ li·ªáu m√≥n ƒÉn t·ª´ file Excel c·ªßa b·∫°n.</p>

          <div class="flex justify-center gap-2 mt-5">
            <button
              onclick="filterFood('all')"
              class="food-filter-btn px-5 py-2 rounded font-bold bg-slate-800 text-white transition shadow hover:bg-slate-700">
              T·∫•t c·∫£
            </button>
            <button
              onclick="filterFood('main')"
              class="food-filter-btn px-5 py-2 rounded font-bold bg-white text-slate-600 border border-slate-300 transition hover:bg-slate-100">
              ƒÇn Ch√≠nh
            </button>
            <button
              onclick="filterFood('snack')"
              class="food-filter-btn px-5 py-2 rounded font-bold bg-white text-slate-600 border border-slate-300 transition hover:bg-slate-100">
              ƒÇn V·∫∑t
            </button>
          </div>
        </div>

        <!-- Grid -->
        <div id="food-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          <!-- Injected via JS -->
        </div>
      </div>
    </section>

    <!-- Budget Section -->
    <section class="py-12 bg-white w-full border-t border-slate-200">
      <div class="max-w-4xl mx-auto px-4 sm:px-6">
        <h2 class="text-2xl font-bold text-slate-900 text-center mb-4">
          Chia "Cam-pu-chia" (T·ªïng 2 ng∆∞·ªùi)
        </h2>
        <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
          <div class="chart-container mx-auto">
            <canvas id="budgetChart"></canvas>
          </div>
        </div>
      </div>
    </section>

    <!-- Chat Widget -->
    <div class="chat-widget">
      <div class="chat-window" id="chatWindow">
        <div class="chat-header">
          <div class="flex items-center gap-2">
            <span class="text-xl">ü§†</span>
            <div>
              <div class="font-bold text-sm">Th·ªï ƒê·ªãa C·∫ßn Th∆° AI</div>
              <div class="text-xs text-emerald-100">H·ªèi ƒë∆∞·ªùng N2 c·ª© h√∫ tui</div>
            </div>
          </div>
          <button onclick="toggleChat()" class="text-white hover:text-amber-400">‚úï</button>
        </div>
        <div class="chat-messages" id="chatMessages">
          <div class="message ai">
            Ch√†o 2 ƒë·∫°i ca! ƒêi N2 l√† chu·∫©n b√†i "ph∆∞·ª£t" r·ªìi. Nh·ªõ ƒë·ªï ƒë·∫ßy xƒÉng ƒëo·∫°n Th·∫°nh H√≥a nghen. C·∫ßn
            t√¨m qu√°n nh·∫≠u ·ªü C·∫ßn Th∆° c·ª© h·ªèi tui! üçª
          </div>
        </div>
        <div class="chat-input-area">
          <input
            type="text"
            id="userQuery"
            placeholder="H·ªèi g√¨ ƒë√≥..."
            onkeypress="handleKeyPress(event)" />
          <button
            onclick="sendMessage()"
            class="bg-emerald-600 text-white p-2 rounded-full hover:bg-emerald-700 w-10 h-10 flex items-center justify-center">
            ‚û§
          </button>
        </div>
      </div>
      <div class="chat-button" onclick="toggleChat()">üí¨</div>
    </div>

    <!-- Modal for Food Review -->
    <div class="modal-overlay" id="reviewModal" onclick="closeReview(event)">
      <div class="modal-content">
        <div class="flex justify-between items-center mb-4 border-b pb-2">
          <h3 class="text-xl font-bold text-slate-800" id="reviewTitle">Review M√≥n ƒÇn</h3>
          <button onclick="closeReview(null)" class="text-slate-500 hover:text-red-500 text-2xl">
            √ó
          </button>
        </div>
        <div id="reviewContent" class="text-slate-600 leading-relaxed">
          <!-- Content from AI -->
        </div>
      </div>
    </div>

    <footer class="bg-slate-900 text-slate-400 py-8 text-center mt-auto">
      <p class="mb-2 text-lg text-white font-bold">Th∆∞·ª£ng L·ªô B√¨nh An nh√© 2 Bro! üèçÔ∏èüí®</p>
      <p class="text-xs">Powered by Gemini API ‚ú¶ N2 Route Edition</p>
    </footer>

    <script>
      // --- Gemini API Configuration ---
      const apiKey = 'AIzaSyABSpYivLdPe6GxQ33ZtcmFlHjinAJL4ik'; // Provided by environment

      // Helper to call Gemini
      async function callGemini(prompt, systemInstruction = '') {
        if (!apiKey) {
          return 'Ch∆∞a c√≥ API Key. (Ch·∫ø ƒë·ªô gi·∫£ l·∫≠p: ƒêi N2 c·∫©n th·∫≠n b·∫Øn t·ªëc ƒë·ªô ƒëo·∫°n ƒê·ª©c H√≤a nha ƒë·∫°i ca!)';
        }
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
        const payload = {
          contents: [{ parts: [{ text: prompt }] }],
          systemInstruction: { parts: [{ text: systemInstruction }] }
        };
        try {
          const response = await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
          if (!response.ok) throw new Error('API Error');
          const data = await response.json();
          return data.candidates?.[0]?.content?.parts?.[0]?.text || 'L·ªói m·∫°ng r·ªìi ƒë·∫°i ca ∆°i!';
        } catch (error) {
          console.error('Gemini Error:', error);
          return 'L·ªói k·∫øt n·ªëi v·ªá tinh.';
        }
      }

      // --- STATE MANAGEMENT ---
      let currentRoute = 'N2'; // Default to N2 based on user request
      let currentDay = 1;

      // --- Custom Data from CSV ---
      const foodData = [
        {
          name: 'Ph·ªë N∆∞·ªõng 102',
          type: 'main',
          address: '16B Tr·∫ßn Ho√†ng Na, C·∫ßn Th∆°',
          mapLink: 'https://goo.gl/maps/xyz',
          tiktok: null,
          desc: 'Qu√°n n∆∞·ªõng b√¨nh d√¢n, kh√¥ng gian r·ªông r√£i, th√≠ch h·ª£p nh·∫≠u lai rai.',
          img: 'https://images.unsplash.com/photo-1555939594-58d7cb561ad1?q=80&w=600&auto=format&fit=crop'
        },
        {
          name: 'L·∫©u M·∫Øm Ki·ªÅu Trinh',
          type: 'main',
          address: '26 Tr·∫ßn Kh√°nh D∆∞, C·∫ßn Th∆°',
          mapLink: 'https://goo.gl/maps/abc',
          tiktok: 'https://tiktok.com/video/123',
          desc: 'L·∫©u m·∫Øm ƒë·∫≠m ƒë√†, rau s·ªëng t∆∞∆°i ngon. ƒêi·ªÉm ƒë·∫øn n·ªïi ti·∫øng.',
          img: 'https://images.unsplash.com/photo-1549203716-1681284d72d5?q=80&w=600&auto=format&fit=crop'
        },
        {
          name: 'B√°nh C·ªëng C√¥ √öt',
          type: 'snack',
          address: '86/38 L√Ω T·ª± Tr·ªçng, C·∫ßn Th∆°',
          mapLink: 'https://goo.gl/maps/def',
          tiktok: 'https://tiktok.com/video/456',
          desc: 'B√°nh c·ªëng gi√≤n r·ª•m, nh√¢n ƒë·∫≠u xanh th·ªãt heo.',
          img: 'https://images.unsplash.com/photo-1604152135912-04a022e23696?q=80&w=600&auto=format&fit=crop'
        },
        {
          name: 'Pizza H·ªß Ti·∫øu',
          type: 'snack',
          address: 'L√≤ S√°u Ho√†i / Ch·ª£ N·ªïi',
          mapLink: 'https://goo.gl/maps/ghi',
          tiktok: 'https://tiktok.com/video/789',
          desc: 'H·ªß ti·∫øu chi√™n gi√≤n ƒÉn nh∆∞ snack.',
          img: 'https://images.unsplash.com/photo-1594236592231-158a8a476831?q=80&w=600&auto=format&fit=crop'
        },
        {
          name: 'Tr√°i C√¢y Ch·ª£ N·ªïi',
          type: 'snack',
          address: 'Ch·ª£ n·ªïi C√°i RƒÉng',
          mapLink: null,
          tiktok: null,
          desc: 'Tr√°i c√¢y t∆∞∆°i r√≥i ngay tr√™n ghe.',
          img: 'https://images.unsplash.com/photo-1519999482648-25049ddd37b1?q=80&w=600&auto=format&fit=crop'
        },
        {
          name: 'Chu·ªëi N·∫øp N∆∞·ªõng',
          type: 'snack',
          address: 'Ch·ª£ C√°i Kh·∫ø, Nguy·ªÖn ƒê·ª©c C·∫£nh',
          mapLink: null,
          tiktok: null,
          desc: 'Chu·ªëi b·ªçc n·∫øp n∆∞·ªõng th∆°m l·ª´ng c·ªët d·ª´a.',
          img: 'https://images.unsplash.com/photo-1603083547854-c8c3e6692823?q=80&w=600&auto=format&fit=crop'
        }
      ];

      // --- ITINERARY DATA (2 ROUTES) ---
      const itineraryData = {
        QL1A: {
          1: [
            {
              time: '05:00',
              title: 'Xu·∫•t ph√°t (QL1A)',
              desc: 'H∆∞·ªõng v·ªÅ B√¨nh Ch√°nh, Long An. ƒê√¥ng xe, nhi·ªÅu b·ª•i, nhi·ªÅu ch·ªët.',
              icon: 'üöõ'
            },
            {
              time: '07:00',
              title: 'ƒÇn s√°ng M·ªπ Tho',
              desc: 'H·ªß ti·∫øu M·ªπ Tho ng√£ 3 Trung L∆∞∆°ng.',
              icon: 'üçú'
            },
            {
              time: '10:30',
              title: 'ƒê·∫øn C·∫ßn Th∆°',
              desc: 'Qua c·∫ßu M·ªπ Thu·∫≠n, c·∫ßu C·∫ßn Th∆°. Check-in kh√°ch s·∫°n.',
              icon: 'üèÅ'
            },
            {
              time: '12:00',
              title: 'B√°nh C·ªëng C√¥ √öt',
              desc: 'ƒÇn tr∆∞a nh·∫π trong h·∫ªm L√Ω T·ª± Tr·ªçng.',
              icon: 'ü•ü'
            },
            { time: '19:00', title: 'Ph·ªë N∆∞·ªõng 102', desc: 'Nh·∫≠u lai rai bu·ªïi t·ªëi.', icon: 'üçª' }
          ]
        },
        N2: {
          1: [
            {
              time: '05:00',
              title: 'Xu·∫•t ph√°t (An S∆∞∆°ng)',
              desc: 'ƒêi T·ªânh L·ªô 10 ho·∫∑c QL22 r·∫Ω v√†o Nguy·ªÖn VƒÉn B·ª©a -> TL9 -> ƒê·ª©c H√≤a.',
              icon: 'üèçÔ∏è'
            },
            {
              time: '07:30',
              title: 'ƒÇn s√°ng Th·∫°nh H√≥a',
              desc: 'D·ªçc ƒë∆∞·ªùng N2 c√≥ c√°c qu√°n B√∫n B√≤/H·ªß Ti·∫øu b√¨nh d√¢n ven r·ª´ng tr√†m. Ngh·ªâ ng∆°i ng·∫Øm ru·ªông.',
              icon: 'üåæ'
            },
            {
              time: '09:30',
              title: 'M·ªπ An - Th√°p M∆∞·ªùi',
              desc: 'ƒêo·∫°n n√†y ƒë∆∞·ªùng ƒë·∫πp, hai b√™n l√† sen v√† l√∫a. Ch·∫°y chill, nh·ªõ ƒë·ªÉ √Ω t·ªëc ƒë·ªô.',
              icon: 'ü™∑'
            },
            {
              time: '11:00',
              title: 'C·∫ßu Cao L√£nh & V√†m C·ªëng',
              desc: 'Hai c√¢y c·∫ßu d√¢y vƒÉng si√™u ƒë·∫πp v√† h√πng vƒ©. Check-in ngay ch√¢n c·∫ßu n·∫øu th√≠ch.',
              icon: 'üåâ'
            },
            {
              time: '12:30',
              title: 'ƒê·∫øn C·∫ßn Th∆°',
              desc: 'V√†o th√†nh ph·ªë ƒë∆∞·ªùng Nguy·ªÖn VƒÉn Linh. Check-in kh√°ch s·∫°n.',
              icon: 'üèÅ'
            },
            {
              time: '19:00',
              title: 'Ph·ªë N∆∞·ªõng 102',
              desc: 'T·ªëi ra Tr·∫ßn Ho√†ng Na l√†m v√†i ly bia.',
              icon: 'üçª'
            }
          ]
        },
        Common: {
          // Days 2 & 3 are same for both
          2: [
            {
              time: '05:15',
              title: 'Ch·ª£ N·ªïi C√°i RƒÉng',
              desc: 'Thu√™ ghe ri√™ng. ƒÇn tr√°i c√¢y, u·ªëng cafe kho.',
              icon: 'üö§'
            },
            { time: '07:30', title: 'Pizza H·ªß Ti·∫øu', desc: 'Gh√© l√≤ h·ªß ti·∫øu S√°u Ho√†i.', icon: 'üçï' },
            {
              time: '11:30',
              title: 'C·ªìn S∆°n',
              desc: 'Qua c·ªìn ƒÉn c∆°m tr∆∞a, xem c√° l√≥c bay.',
              icon: 'üêü'
            },
            {
              time: '19:00',
              title: 'L·∫©u M·∫Øm Ki·ªÅu Trinh',
              desc: 'Tr·∫ßn Kh√°nh D∆∞. M√≥n n√†y ph·∫£i ƒÉn cho bi·∫øt v·ªã mi·ªÅn T√¢y.',
              icon: 'üç≤'
            }
          ],
          3: [
            {
              time: '08:00',
              title: 'Cafe & Ki·ªÉm tra xe',
              desc: 'Chu·∫©n b·ªã xe c·ªô ƒë·ªÉ v·ªÅ l·∫°i SG (ƒê∆∞·ªùng N2 v·∫Øng n√™n xe ph·∫£i ngon).',
              icon: 'üîß'
            },
            { time: '10:00', title: 'Mua Qu√†', desc: 'B√°nh t√©t, nem chua.', icon: 'üéÅ' },
            {
              time: '12:00',
              title: 'ƒÇn tr∆∞a & V·ªÅ',
              desc: 'V·ªÅ l·∫°i cung ƒë∆∞·ªùng N2 ho·∫∑c ƒë·ªïi gi√≥ QL1A t√πy s·ª©c kh·ªèe.',
              icon: 'üîô'
            }
          ]
        }
      };

      // --- Core Functions ---

      function toggleRoute() {
        currentRoute = currentRoute === 'N2' ? 'QL1A' : 'N2';
        document.body.className = `antialiased min-h-screen flex flex-col route-mode-${currentRoute.toLowerCase()}`;

        // Update Text Info
        const desc = document.getElementById('route-desc');
        const subtitle = document.getElementById('itinerary-subtitle');

        if (currentRoute === 'N2') {
          desc.innerHTML = `ƒêang ch·ªçn: <strong>Cung ƒë∆∞·ªùng N2</strong>. <br>Xuy√™n r·ª´ng tr√†m, ru·ªông l√∫a ƒê·ªìng Th√°p M∆∞·ªùi. √çt c√¥ng an, √≠t b·ª•i, c·∫£nh si√™u chill nh∆∞ng v·∫Øng v·∫ª.`;
          subtitle.innerText = 'ƒêang hi·ªÉn th·ªã l·ªô tr√¨nh N2 (ƒê·ªìng Th√°p M∆∞·ªùi)';
          updateStats('N2');
        } else {
          desc.innerHTML = `ƒêang ch·ªçn: <strong>Qu·ªëc l·ªô 1A</strong>. <br>ƒê∆∞·ªùng l·ªõn, ƒë√¥ng vui, nhi·ªÅu tr·∫°m d·ª´ng ch√¢n nh∆∞ng b·ª•i v√† nhi·ªÅu ch·ªët c√¥ng an.`;
          subtitle.innerText = 'ƒêang hi·ªÉn th·ªã l·ªô tr√¨nh QL1A (Truy·ªÅn Th·ªëng)';
          updateStats('QL1A');
        }

        // Refresh Itinerary
        switchDay(currentDay);
      }

      function updateStats(route) {
        if (route === 'N2') {
          document.getElementById('stat-icon-1').innerText = 'üå≤';
          document.getElementById('stat-title-1').innerText = 'C·∫£nh Quan';
          document.getElementById('stat-desc-1').innerText =
            'Ru·ªông l√∫a, Sen, R·ª´ng tr√†m. R·∫•t m√°t m·∫Øt.';

          document.getElementById('stat-icon-2').innerText = '‚ö†Ô∏è';
          document.getElementById('stat-title-2').innerText = 'L∆∞u √ù N2';
          document.getElementById('stat-desc-2').innerText = '√çt c√¢y xƒÉng. Tuy·ªát ƒë·ªëi kh√¥ng ƒëi ƒë√™m.';

          document.getElementById('stat-icon-3').innerText = 'üìç';
          document.getElementById('stat-title-3').innerText = 'L·ªô Tr√¨nh';
          document.getElementById('stat-desc-3').innerText =
            'An S∆∞∆°ng ‚ûî ƒê·ª©c H√≤a ‚ûî Th·∫°nh H√≥a ‚ûî C·∫ßu V√†m C·ªëng.';
        } else {
          document.getElementById('stat-icon-1').innerText = 'üöõ';
          document.getElementById('stat-title-1').innerText = 'Giao Th√¥ng';
          document.getElementById('stat-desc-1').innerText =
            'ƒê√¥ng xe t·∫£i, xe kh√°ch. ƒê∆∞·ªùng r·ªông nh∆∞ng b·ª•i.';

          document.getElementById('stat-icon-2').innerText = 'üëÆ';
          document.getElementById('stat-title-2').innerText = 'L∆∞u √ù QL1A';
          document.getElementById('stat-desc-2').innerText =
            'B·∫Øn t·ªëc ƒë·ªô r√°t ·ªü Ti·ªÅn Giang (Cai L·∫≠y/Ch√¢u Th√†nh).';

          document.getElementById('stat-icon-3').innerText = 'üìç';
          document.getElementById('stat-title-3').innerText = 'L·ªô Tr√¨nh';
          document.getElementById('stat-desc-3').innerText =
            'B√¨nh Ch√°nh ‚ûî T√¢n An ‚ûî M·ªπ Tho ‚ûî C·∫ßu M·ªπ Thu·∫≠n.';
        }
      }

      function switchDay(day) {
        currentDay = day;
        // Update Buttons
        document.querySelectorAll('[id^="tab-day"]').forEach((btn) => {
          btn.className =
            'px-5 py-2 rounded font-bold transition bg-slate-100 text-slate-600 hover:bg-slate-200 border-2 border-transparent';
        });
        const activeBtn = document.getElementById(`tab-day${day}`);
        const colorClass =
          currentRoute === 'N2'
            ? 'bg-emerald-600 border-emerald-600'
            : 'bg-slate-600 border-slate-600';
        activeBtn.className = `px-5 py-2 rounded font-bold transition text-white shadow-md transform scale-105 border-2 ${colorClass}`;

        const container = document.getElementById('timeline-content');
        container.innerHTML = '';

        // Decide which data to use
        let data = [];
        if (day === 1) {
          data = itineraryData[currentRoute][1];
        } else {
          data = itineraryData.Common[day];
        }

        const accentColor = currentRoute === 'N2' ? 'emerald' : 'slate';

        data.forEach((item, index) => {
          const isLast = index === data.length - 1;
          const html = `
                    <div class="relative pl-8 ${isLast ? '' : 'pb-8'}">
                        ${!isLast ? `<div class="absolute left-[-11px] top-2 h-full w-0.5 bg-${accentColor}-200"></div>` : ''}
                        <div class="absolute left-[-24px] top-0 flex h-8 w-8 items-center justify-center rounded-full bg-white border-2 border-${accentColor}-500 text-lg z-10 shadow-sm">
                            ${item.icon}
                        </div>
                        <div class="group relative rounded bg-white p-4 border border-slate-200 hover:shadow-md transition-all duration-200 hover:border-${accentColor}-400">
                            <span class="inline-block px-2 py-0.5 mb-2 text-xs font-bold text-${accentColor}-700 bg-${accentColor}-100 rounded">
                                ${item.time}
                            </span>
                            <h3 class="text-lg font-bold text-slate-800">${item.title}</h3>
                            <p class="mt-1 text-slate-600 text-sm leading-relaxed">${item.desc}</p>
                        </div>
                    </div>
                `;
          container.innerHTML += html;
        });
      }

      function renderFood(filterType) {
        const grid = document.getElementById('food-grid');
        grid.innerHTML = '';
        const filtered =
          filterType === 'all' ? foodData : foodData.filter((f) => f.type === filterType);

        filtered.forEach((item) => {
          const fallbackUrl = `https://via.placeholder.com/600x400/cbd5e1/475569?text=${encodeURIComponent(item.name)}`;
          let linksHtml = '';
          if (item.mapLink)
            linksHtml += `<a href="${item.mapLink}" target="_blank" class="btn-icon bg-blue-100 text-blue-700 px-3 py-1.5 rounded-md text-xs font-bold hover:bg-blue-200">Ch·ªâ ƒê∆∞·ªùng üó∫Ô∏è</a>`;
          if (item.tiktok)
            linksHtml += `<a href="${item.tiktok}" target="_blank" class="btn-icon bg-black text-white px-3 py-1.5 rounded-md text-xs font-bold hover:bg-gray-800 ml-2">TikTok üéµ</a>`;

          const card = `
                    <div class="food-card bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden hover:shadow-xl transition duration-300 flex flex-col h-full group relative">
                        <div class="h-48 overflow-hidden relative bg-slate-200 img-skeleton">
                             <img src="${item.img}" alt="${item.name}" 
                                class="food-card-img w-full h-full object-cover opacity-0 transition-opacity duration-300"
                                onload="this.classList.remove('opacity-0'); this.parentElement.classList.remove('img-skeleton');"
                                onerror="this.onerror=null; this.src='${fallbackUrl}'; this.classList.remove('opacity-0'); this.parentElement.classList.remove('img-skeleton');">
                        </div>
                        <div class="p-5 flex flex-col flex-grow">
                            <h4 class="text-lg font-bold text-slate-800 mb-1 group-hover:text-emerald-600 transition">${item.name}</h4>
                            <p class="text-xs text-slate-500 mb-2 font-medium italic truncate">üìç ${item.address}</p>
                            <p class="text-sm text-slate-600 mb-4 flex-grow line-clamp-3">${item.desc}</p>
                            <div class="flex flex-wrap gap-2 mb-3">${linksHtml}</div>
                            <div class="text-xs text-slate-400 border-t pt-3 flex items-center justify-between mt-auto">
                                <span class="text-emerald-600 font-bold">${item.type === 'main' ? 'M√≥n Ch√≠nh' : 'ƒÇn V·∫∑t'}</span>
                                <button onclick="getFoodReview('${item.name}')" class="text-emerald-600 hover:text-emerald-700 font-bold text-xs flex items-center gap-1 bg-emerald-50 px-2 py-1 rounded-full border border-emerald-200">AI Review ‚ú®</button>
                            </div>
                        </div>
                    </div>
                `;
          grid.innerHTML += card;
        });
      }

      function filterFood(type) {
        document.querySelectorAll('.food-filter-btn').forEach((btn) => {
          btn.classList.remove('bg-slate-800', 'text-white');
          btn.classList.add('bg-white', 'text-slate-600', 'border', 'border-slate-300');
        });
        event.target.classList.remove('bg-white', 'text-slate-600', 'border', 'border-slate-300');
        event.target.classList.add('bg-slate-800', 'text-white');
        renderFood(type);
      }

      function scrollToSection(id) {
        const el = document.getElementById(id);
        const navHeight = 80;
        const y = el.getBoundingClientRect().top + window.pageYOffset - navHeight;
        window.scrollTo({ top: y, behavior: 'smooth' });
        document.getElementById('mobile-nav').classList.add('hidden');
      }

      function toggleMobileNav() {
        document.getElementById('mobile-nav').classList.toggle('hidden');
      }

      // --- Chat & AI ---
      function toggleChat() {
        document.getElementById('chatWindow').style.display =
          document.getElementById('chatWindow').style.display === 'flex' ? 'none' : 'flex';
      }

      async function sendMessage() {
        const input = document.getElementById('userQuery');
        const messages = document.getElementById('chatMessages');
        const text = input.value.trim();
        if (!text) return;
        messages.innerHTML += `<div class="message user">${text}</div>`;
        input.value = '';
        messages.scrollTop = messages.scrollHeight;

        const loadingId = 'loading-' + Date.now();
        messages.innerHTML += `<div class="message ai typing-indicator" id="${loadingId}"><span></span><span></span><span></span></div>`;
        messages.scrollTop = messages.scrollHeight;

        const systemPrompt =
          'B·∫°n l√† Th·ªï ƒê·ªãa C·∫ßn Th∆°, chuy√™n gia ph∆∞·ª£t ƒë∆∞·ªùng N2. T∆∞ v·∫•n ng·∫Øn g·ªçn, vui v·∫ª.';
        const response = await callGemini(text, systemPrompt);

        document.getElementById(loadingId).remove();
        messages.innerHTML += `<div class="message ai">${marked.parse(response)}</div>`;
        messages.scrollTop = messages.scrollHeight;
      }

      function handleKeyPress(e) {
        if (e.key === 'Enter') sendMessage();
      }

      async function getFoodReview(foodName) {
        const modal = document.getElementById('reviewModal');
        const content = document.getElementById('reviewContent');
        document.getElementById('reviewTitle').innerText = `Review: ${foodName}`;
        content.innerHTML = `<div class="flex justify-center p-10"><div class="typing-indicator"><span></span><span></span><span></span></div></div>`;
        modal.style.display = 'flex';
        const response = await callGemini(
          `Review m√≥n ${foodName} ·ªü C·∫ßn Th∆°.`,
          'Chuy√™n gia ·∫©m th·ª±c mi·ªÅn T√¢y. Review h·∫•p d·∫´n.'
        );
        content.innerHTML = marked.parse(response);
      }

      function closeReview(e) {
        if (!e || e.target.id === 'reviewModal' || e.target.tagName === 'BUTTON')
          document.getElementById('reviewModal').style.display = 'none';
      }

      // --- Init ---
      document.addEventListener('DOMContentLoaded', () => {
        switchDay(1); // Loads Day 1 based on default N2 route
        renderFood('all');

        new Chart(document.getElementById('budgetChart'), {
          type: 'bar',
          data: {
            labels: ['Kh√°ch S·∫°n', 'ƒÇn U·ªëng', 'XƒÉng Xe', 'V√©/Tour', 'D·ª± Ph√≤ng'],
            datasets: [
              {
                label: 'VND',
                data: [1200000, 3000000, 300000, 500000, 500000],
                backgroundColor: ['#64748B', '#F59E0B', '#10B981', '#06B6D4', '#94A3B8'],
                borderRadius: 4
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: { beginAtZero: true, ticks: { callback: (v) => (v / 1000000).toFixed(1) + ' tr' } }
            },
            plugins: { legend: { display: false } }
          }
        });
      });
    </script>
  </body>
</html>
